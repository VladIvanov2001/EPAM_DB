DEFINE DATA_TBS_NAME = &&1
DEFINE CURS = '_DATA'

CREATE TABLE COMPOSITON_REVIEW 
(
  ID_REVIEW INT GENERATED ALWAYS AS IDENTITY INCREMENT BY 1 START WITH 1 MINVALUE 1 NOMAXVALUE NOT NULL 
, ID_USER INT NOT NULL 
, ID_COMPOSITION INT NOT NULL 
, REVIEW VARCHAR2(50) NOT NULL 
, CONSTRAINT COMPOSITON_REVIEW_PK PRIMARY KEY 
  (
    ID_REVIEW 
  )
  ENABLE 
)
TABLESPACE &&DATA_TBS_NAME&&CURS;

ALTER TABLE COMPOSITON_REVIEW ADD CONSTRAINT fk_COMPOSITON_REVIEW_ID_USER FOREIGN KEY(ID_USER)
REFERENCES Users (ID_USER);

ALTER TABLE COMPOSITON_REVIEW ADD CONSTRAINT fk_COMPOSITON_REVIEW_ID_COMPOSITION FOREIGN KEY(ID_COMPOSITION)
REFERENCES Composition (ID_COMPOSITION);

CREATE UNIQUE INDEX COMPOSITON_REVIEW_ID_USER ON COMPOSITON_REVIEW (ID_USER ASC);

CREATE UNIQUE INDEX COMPOSITON_REVIEW_ID_COMPOSITION ON COMPOSITON_REVIEW (ID_COMPOSITION ASC);

COMMENT ON COLUMN COMPOSITON_REVIEW.ID_REVIEW IS 'primary key';

COMMENT ON COLUMN COMPOSITON_REVIEW.ID_USER IS 'foreign key from USERS';

COMMENT ON COLUMN COMPOSITON_REVIEW.ID_COMPOSITION IS 'foreign key from COMPOSTION, may be null';

COMMENT ON COLUMN COMPOSITON_REVIEW.REVIEW IS 'just opinion about composition';